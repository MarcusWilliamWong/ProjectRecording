<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<p>Online Chat</p>
	<div>
		<input id="msginput" type="text">
		<button id="submitbtn">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
			<path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
		</svg></button>
	</div>
</body>
<script type="text/javascript">
	// 在页面显示聊天内容
	function showMessage(str, type) {
		let div = document.createElement("div");
		div.textContent = str;
		// 根据不同的消息类型，文字用不同的颜色
		if (type == "enter") {
			div.style.color = "blue";
		} else if (type == "leave") {
			div.style.color = "red";
		}
		// 将组件添加到DOM中
		document.body.appendChild(div);
	}
	//？？？需要吗
	// const WebSocket = require("nodejs-websocket").client;
	// 新建WebSocket对象
	// 向websocket主机端发送连接请求
	let ws = new WebSocket("ws://172.16.3.159:8010");
	// https://websockets.spec.whatwg.org/#eventdef-websocket-open
	// 查看WebSocket的接口定义，使用函数表达式实现EnventHandler onopen
	// 打开websocket连接
	ws.onopen = function () { // js 中的自执行匿名函数，定义和调用合为一体
		console.log("WebSocket server connected...");
		// 成功与主机端建立WebSocket连接后，才将事件绑定到按钮上
		document.getElementById("submitbtn").onclick = function () {
			let txt = document.getElementById("msginput").value;
			if (txt) {
				// 如果不为空，则向服务器发送数据
				ws.send(txt);
			}
		};
	};

	// 定义关闭连接时触发的事件
	ws.onclose = function () {
		console.log("WebSocket sever close.");
	};

	// 接收服务器返回的数据
	// 用于指定当从服务器接受到信息时的回调函数。
	// WebSocket实例事件message接收参数MessageEvent
	// MessageEvent属性data包含来自萨松者的数据
	// 具体查看https://developer.mozilla.org/zh-CN/docs/Web/API/MessageEvent
	ws.onmessage = function (e) {
		// 传输数据为JSON格式
		// 可以使用JavaScript内置对象JSON的方法JSON.parse解析数据
		let msg = JSON.parse(e.data);
		// let msg = e.data;
		// JSON.parse返回值为Object
		// 注意这里的消息类型是自定义的Object，使用JSON的字符串交换数据
		// 第一个属性定义为"data"，第二个属性定义为"type"
		showMessage(msg.data, msg.type);
	}
</script>
</html>